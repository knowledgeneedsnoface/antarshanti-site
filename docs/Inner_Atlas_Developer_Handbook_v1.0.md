# Inner Atlas
## Developer Documentation Handbook v1.0

**Author**: Generated by Claude AI â€” based on structured product architecture
**Date**: December 14, 2025

---

## 1. Summary Overview

### Purpose
Inner Atlas is a holistic digital wellness application rooted in modern Indian spirituality. It guides users through a process of self-discovery (Diagnostic), assigns them a personalized daily practice (Ritual), and helps them maintain consistency through companionship (Soul Twin) and insights (Analytics).

### The Journey
1.  **Onboarding (Modules 1-8)**: The user enters a cinematic "Inner World" (Chariot -> Mind -> Heart -> Shadow). They identify their current struggles in "Kurukshetra" (the battlefield) and select "Power Objects" (Dhanush, Chakra, Rath) to help them. A "Cosmic Gita Moment" connects their struggle to ancient wisdom.
2.  **Assignment (Module 9)**: Based on their diagnostic choices, the system assigns a specific Yoga ritual (Karma, Bhakti, Tapasya, etc.).
3.  **Daily Loop (Modules 10-14)**: The user returns daily to a "Home" screen. They perform the assigned ritual (guided timer), reflect on their mood, track streaks, and interact with their AI Soul Twin companion.
4.  **Retention (Modules 15-16)**: Users are delighted by daily surprises (Magic Box) and can explore the narrative backstory (Lore Book).

### Architecture Summary
-   **Tech Stack**: Next.js (App Router), React, Tailwind CSS, Framer Motion.
-   **Structure**: A single "App Shell" manages the entire state and navigation, rendering modular components based on the current step.
-   **Data**: Currently local-state driven (simulated backend).

---

## 2. System Architecture Diagram

```ascii
+-------------------------------------------------------------+
|                     INNER ATLAS APP SHELL                   |
|              (components/InnerAtlas/InnerAtlasAppShell.tsx) |
|                                                             |
|   [GLOBAL STATE]                                            |
|   - Screen: "chariot" | "home" | "ritualPlayer" ...         |
|   - Diagnostics: Mind, Heart, Shadow, Battle, Power         |
|   - Daily: Mood, Streak, History                            |
|                                                             |
|   [ROUTER LOGIC]                                            |
|   switch(screen) {                                          |
|      case "chariot": return <ChariotArrival />              |
|      case "home":    return <DailyRitualHome />             |
|      ...                                                    |
|   }                                                         |
|                                                             |
+-------+-------------------------+---------------------------+
        |                         |
        v                         v
  +-----------+           +------------------+
  | MODULES   |           | SOUL TWIN SYSTEM |
  | (1 - 16)  |           | (Observer)       |
  +-----------+           +------------------+
        |                       ^
        | Events (e.g. "ritual_complete")
        +-----------------------+
```

---

## 3. Component Library Reference

All components reside in `components/InnerAtlas/`.

| Module | Component Name | Core Responsibility | Key Props (Inputs) | Callbacks (Outputs) |
| :--- | :--- | :--- | :--- | :--- |
| **01** | `ChariotArrival` | Intro animation & "Start" | - | `onStartInnerAtlas` |
| **02** | `MindRealm` | Select mental state | - | `onMindSelection` |
| **03** | `HeartRealm` | Select emotional state | - | `onHeartSelection` |
| **04** | `ShadowRealm` | Select inner shadow | - | `onShadowSelection` |
| **05** | `KurukshetraSelection` | Identify core conflict | - | `onKurukshetraSelection` |
| **06** | `PowerObjectsSelector` | Equip spiritual tools | - | `onPowerObjectsSelection` |
| **07** | `CosmicGitaMoment` | Cinematic transition | `kurukshetraBattleKey` | `onGitaMomentComplete` |
| **08** | `SoulMapReveal` | Summary of diagnostics | `mindStateKey`, `heartStateKey`... | `onSoulMapComplete` |
| **09** | `RitualAssignment` | Assign practice logic | `mindStateKey`... | `onRitualAssigned` |
| **10** | `DailyRitualHome` | Daily dashboard entry | `assignedRitualKey`, `gitaLine` | `onStartRitual`, `onOpen...` |
| **11** | `RitualPlayer` | Guided timer (10 min) | `assignedRitualKey` | `onRitualComplete` |
| **12** | `PostRitualReflection` | Mood tracking & Streak | `assignedRitualKey`, `streakCount` | `onReflectionComplete` |
| **13** | `DailyDashboard` | Analytics & History | `moodHistory`, `ritualHistory` | `onCloseDashboard` |
| **14** | `SoulTwinReaction` | Reacting Avatar | `eventType`, `characterMode` | - |
| **15** | `DailySurpriseGenerator`| Retention hook (Overlay) | `lastSurpriseDate` | `onSurpriseGenerated` |
| **16** | `LoreBook` | Narrative Explorer | - | `onCloseLoreBook` |
| **17** | `InnerAtlasAppShell` | **MASTER CONTROLLER** | `initialScreen?` | - |

---

## 4. Module API Specs (Selected Critical Modules)

### **Module 17: InnerAtlasAppShell**
The container that must be imported by `page.tsx`.
```tsx
// Usage
<InnerAtlasAppShell initialScreen="home" />
```

### **Module 10: DailyRitualHome**
The hub for the daily user.
**Props**:
- `assignedRitualKey`: string (e.g. "karma_yoga")
- `gitaLine`: string (e.g. "Yogastha Kuru Karmani")
- `onStartRitual`: (key, mood) => void
- `onOpenDashboard`: () => void
- `onOpenLore`: () => void
- `onOpenSurprise`: () => void

### **Module 06: PowerObjectsSelector**
Complex selection logic.
**Props**:
- `onPowerObjectsSelection`: (selections: { dhanush: DhanushKey, chakra: ChakraKey, rath: RathKey }) => void

---

## 5. Data Models

### **Diagnostic Keys** (String Unions)
- `MindStateKey`: "stormy_sky" | "quiet_lake" | "crowded_bazaar" | "desert_wind" | "old_forest"
- `HeartStateKey`: "heavy" | "restless" | "numb" | "overflowing" | "guarded"
- `ShadowStateKey`: "fear_failure" | "imposter" | "anger" | "loneliness" | "unworthiness"
- `BattleKey`: "duty_vs_desire" | "fear_vs_ambition" | "love_vs_boundaries" | "truth_vs_comfort" | "chaos_vs_focus"

### **User History**
```typescript
interface MoodHistoryItem {
    date: number; // Timestamp
    previousMood: string;
    afterMood: string;
}

interface RitualHistoryItem {
    date: number;
    ritualKey: string;
}
```

### **Power Objects**
```typescript
interface PowerObjectsSelections {
    dhanush: "focus" | "strength" | "care" | "wisdom" | "fire";
    chakra: "truth" | "love" | "freedom" | "growth" | "stability";
    rath: "stability_path" | "expansion_path" | "healing_path";
}
```

---

## 6. Navigation & Routing Logic

The App Shell uses a simple `screen` state variable:

1.  **Onboarding Flow**:
    `chariot` -> `mind` -> `heart` -> `shadow` -> `kurukshetra` -> `power` -> `gitaMoment` -> `soulMap` -> `ritualAssignment` -> `home`.

2.  **Daily Flow**:
    `home` -> `ritualPlayer` -> `postReflection` -> `home`.

3.  **Overlays & Sub-Screens**:
    -   `dashboard`: Accessed via `home` button -> Back to `home`.
    -   `lorebook`: Accessed via `home` button -> Back to `home`.
    -   `surprise`: Rendered conditionally **on top** of `home` (modal), not a route change.

**Persistence**:
Currently, state resets on reload. In production, `useEffect` should save/load `screen` and `userData` to `localStorage` or DB.

---

## 7. Soul Twin System Specs

The "Soul Twin" is an observer component located in `components/InnerAtlas/SoulTwinReaction.tsx`.
It does not manage state; it **responds** to props passed by the parent.

**Event Triggers**:
| Event Type | Trigger Condition | Twin Reaction |
| :--- | :--- | :--- |
| `daily_check_in` | User lands on Home | Greetings ("Namaste, Seeker") |
| `mood_selected` | User taps mood emoji | Empathy ("Energy high hai!") |
| `ritual_started` | User hits Play | Encouragement ("Focus on breath") |
| `ritual_completed` | Timer ends | Celebration ("Well done!") |
| `streak_updated` | Streak increases | High Five Animation |
| `dashboard_opened` | Dashboard opens | Analytical comment ("Look at that curve") |

**Modes**:
- `gann_baba`: Analytical, Wise, Male voice.
- `mira_maya`: Playful, Emotive, Female voice.
- `duo`: Both alternate (used on Home/Reflection).

---

## 8. Global State Management

Managed in `InnerAtlasAppShell.tsx` using `useState`.

-   **Diagnostic State**: Nullable until selected.
-   **Mood State**: `todayMood` (Pre-ritual) and `postMood` (Post-ritual).
-   **Streak State**: `streakCount` (Integer) and `weeklyCompletion` (Array of 7 booleans).
-   **History**: Arrays of objects, appended on completions.

**Update Logic**:
-   `streakCount` increments on `ritual_completed`.
-   `weeklyCompletion` updates index corresponding to `new Date().getDay()`.

---

## 9. Assets & File Structure

**Root**: `public/assets/`

**Naming Convention**: `[category]-[specific].svg`

**Key Assets**:
-   **Avatars**: `gann-baba-avatar.svg`, `mira-maya-avatar.svg`, `soul-twin-avatar.svg`, `twin-duo-avatar.svg`
-   **Ritual Cards**: `ritual-card-karma.svg`, `ritual-card-bhakti.svg`...
-   **Realms**: `mind-storm.svg`, `heart-heavy.svg`, `shadow-mask.svg`...
-   **Power Objects**: `dhanush-focus.svg`, `chakra-truth.svg`...
-   **UI**: `magic-box.svg`, `surprise-icon.svg`, `ritual-success.svg`

**Note**: All assets are vector SVGs for scalability and small file size.

---

## 10. Build & Deployment

### Local Development
1.  **Install**: `npm install`
2.  **Run**: `npm run dev`
3.  **Access**: `http://localhost:3000/inner-atlas`

### Requirements
-   React 18+
-   Next.js 14+ (App Router)
-   Framer Motion
-   Lucide React (Icons)
-   Tailwind CSS

### Deployment
Standard Next.js deployment.
-   **Vercel**: Connect Repo -> Deploy. Zero config needed.
-   **Environment**: No env vars required for current v1.0 (local state).

---

## 11. Error Handling

-   **Type Safety**: The App Shell enforces strict types for keys (e.g., `DhanushKey`). Invalid strings will cause build errors (as seen in development).
-   **Defaults**: The Shell initializes with safe default values (e.g., `dhanush: "focus"`) to prevent null pointer exceptions if a user jumps straight to `SoulMap`.
-   **Boundaries**: `app/inner-atlas/page.tsx` uses `<Suspense>` to handle loading states safe.

---

## 12. Coding Standards

1.  **Files**: PascalCase for components (`DailyRitualHome.tsx`).
2.  **Imports**: Group external (React, Framer) separate from internal (Components, Types).
3.  **Styles**: Tailwind CSS utility classes. Avoid inline styles unless dynamic (framer-motion).
4.  **Language**: "Hinglish" (Hindi + English) for user-facing text. English for code comments.
5.  **Motion**: Use `<AnimatePresence mode="wait">` for page transitions.

---

## 13. Performance Best Practices

1.  **Lazy Loading**: The App Shell imports modules statically, but Next.js optimizes bundling. For larger modules (like Lore Book), consider `React.lazy` if bundle size grows.
2.  **Animations**: Use `layoutId` sparingly. Rely on simple `opacity` and `x` transitions for navigation to keep FPS high.
3.  **Assets**: SVGs are small. Avoid large PNGs.
4.  **Re-renders**: The Shell dictates state. Sub-components are generally pure. Avoid lifting ephemeral state (like "isHovered") to the Shell; keep it local.

---

## 14. Extending Inner Atlas (Roadmap)

-   **Backend Persistence**: Connect `InnerAtlasAppShell` state setters to a REST/GraphQL API (e.g. `POST /api/save-reflection`).
-   **Audio Rituals**: Enhance `RitualPlayer` to play actual `.mp3` files (currently visual timer).
-   **AI Chat**: Connect `SoulTwinReaction` to the `/api/twin-chat` endpoint for real LLM conversations.
-   **Social**: Add "Share" button to `SoulMapReveal`.

---

## 15. Developer Onboarding Checklist

-   [ ] **Clone & Install**: `git clone ... && npm install`.
-   [ ] **Review Shell**: Open `components/InnerAtlas/InnerAtlasAppShell.tsx`. This is the map.
-   [ ] **Trace Logic**: Follow the `next()` function in the shell to understand flow.
-   [ ] **Check Assets**: Look at `public/assets` to see the style.
-   [ ] **Try It**: Run `npm run dev` and go to `/inner-atlas`. Complete the journey once.
-   [ ] **Debug**: Use React DevTools to inspect "InnerAtlasAppShell" state.
